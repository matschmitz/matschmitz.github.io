<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8">
  <title>exp</title>
  <script src="jspsych-6.0.3/jspsych.js"></script>
  <script src="jspsych-6.0.3/plugins/jspsych-fullscreen.js"></script>
  <script src="jspsych-6.0.3/plugins/jspsych-html-keyboard-response.js"></script>
  <script src="jspsych-6.0.3/plugins/jspsych-html-button-response.js"></script>
  <script src="jspsych-6.0.3/plugins/jspsych-survey-text.js"></script>
  <script src="js/jspsych-html-mouse-response.js"></script>
  <script src="js/jquery.min.js"></script>
  <script src="js/lodash.min.js"></script>
  <script src="js/firebase.js"></script>
  <link href="jspsych-6.0.3/css/jspsych.css" rel="stylesheet" type="text/css">
  <style>
    body {
      cursor: default;
    }

    .rcimg-12 {
      cursor: pointer;
      margin: 10px;
    }

    .rcimg-12:hover {
      box-shadow: 0 4px 8px 0 rgba(0, 0, 0, 0.2), 0 6px 20px 0 rgba(0, 0, 0, 0.19);
    }

    .jspsych-content-wrapper {
      width: 800px;
      height: 650px;
    }
  </style>
</head>

<body></body>

<script>
  /* Parameters */
  var itiSta = 400;  // 400; inter-trial-interval for statements
  var delaySta = 6000; // 5500; how long is each statement displayed
  var numOfPairs = 100 * 6; // Total number of pairs images for the RC (inv & ori)
  var qlink = "https://uclpsychology.co1.qualtrics.com/jfe/form/SV_9p0SU1YtG3xmxhz";

  /* Initial variables */
  var timeline = [];
  var HC = [];
  var LC = [];
  var preloadimagesRC = [];
  var id = jsPsych.data.getURLVariable("id");
  var hghGrp = jsPsych.data.getURLVariable("hghGrp");    // counterbalanced

  // EXPERIMENT -----------------------------------------------------------------------------------------------------------------
  /* IMPRESION FORMATION */
  /* Generate statements */
  var CP = ['CP1', 'CP2', 'CP3', 'CP4', 'CP5', 'CP6', 'CP7', 'CP8']; // C+
  var CN = ['CN1', 'CN2', 'CN3', 'CN4', 'CN5', 'CN6', 'CN7', 'CN8']; // C-
  var WP = ['WP1', 'WP2', 'WP3', 'WP4', 'WP5', 'WP6', 'WP7', 'WP8']; // W+
  var WN = ['WN1', 'WN2', 'WN3', 'WN4', 'WN5', 'WN6', 'WN7', 'WN8']; // w-

  // HC: 6C+, 2C-, 2W+, 2W-
  HC = HC.concat(_.sampleSize(CP, 6), _.sampleSize(CN, 2), _.sampleSize(WP, 0), _.sampleSize(WN, 0));

  // LC: 2C+, 6C-, 2W+, 2W-
  var CPleft = _.difference(CP, HC);
  var CNleft = _.difference(CN, HC);
  var WPleft = _.difference(WP, HC);
  var WNleft = _.difference(WN, HC);
  LC = LC.concat(_.sampleSize(CPleft, 2), _.sampleSize(CNleft, 6), _.sampleSize(WPleft, 0), _.sampleSize(WNleft, 0));

  HC = _.shuffle(HC);
  LC = _.shuffle(LC);

  // Assign group identity (B vs. G)
  var hghGrp = hghGrp == null ? _.sample(['B', 'G']) : hghGrp;
  var lowGrp = _.difference(['B', 'G'], [hghGrp])[0];
  var inGrp = 'O'; // only observers
  if (inGrp == hghGrp) { var status = "H" };
  if (inGrp == lowGrp) { var status = "L" };
  if (inGrp == 'O') { var status = 'O' };

  HC = HC.map(function (e) { return e + hghGrp });
  LC = LC.map(function (e) { return e + lowGrp });

  var hghFstSta = _.sample([true, false]);
  if (hghFstSta) { var staOrd = HC.concat(LC) } else { var staOrd = LC.concat(HC) };
  if (hghGrp == 'B') {
    var HcolorHtml = "<span id='blue'>GROUPE BLEU</span>";
    var LcolorHtml = "<span id='green'>GROUPE VERT</span>";
  } else {
    var HcolorHtml = "<span id='green'>GROUPE VERT</span>";
    var LcolorHtml = "<span id='blue'>GROUPE BLEU</span>";
  };

  /* Statements */
  var CP = [
    "X a remporté le prix annuel de l'employé qui contribue le plus au profit de l'entreprise.",
    "X a s’est entrainé à jouer un morceau de violon 20 fois par jour, et après un mois, a estimé qu'il savait bien la jouer.",
    "X a conçu un petit programme informatique destiné à résoudre un problème d'intégrale mathématique très compliqué.",
    "X parle couramment quatre langues différentes.",
    "X a présenté ses recherches lors d'un congrès de chimie.",
    "X a publié une nouvelle dans un magazine littéraire très connues avant la fin de ses études.",
    "X a beaucoup travaillé sur une tâche d’algèbre linéaire afin d’obtenir des points bonus à son examen.",
    "X fait très attention quand il s'agit d'épargner afin de pouvoir s’acheter une maison."
  ];
  var CN = [
    "X est allé·e faire de la randonnée en montagne et a dû se faire secourir car il/elle n'avait pas fait attention au chemin qu’il/elle avait emprunté.",
    "X a été renvoyé de son travail parce qu'il/elle a rarement fait les choses à temps.",
    "Le vélo de X a été volé plusieurs fois parce qu'il/elle oublie de le cadenasser.",
    "X se perd souvent lorsqu’elle conduit en ville, même s'il/elle y vit depuis plusieurs années.",
    "L'électricité de X a été coupée parce qu'il/elle n'a pas payé la facture à temps.",
    "X a eu difficile à trouver du travail parce qu'il/elle était toujours en retard pour des entretiens d’embauche.",
    "X a mis près d'une heure pour trouver sa voiture après l'avoir garée dans un centre commercial.",
    "X a raté son permis de conduire pour la quatrième fois et a fini par l'abandonner."
  ];
  var WP = [
    "X a passé des heures avec un ami dont le chien venait de mourir.",
    "X adore être entouré d'autres personnes.",
    "X a aidé une femme aveugle à traverser la rue.",
    "X salue toujours ses amis avec une accolade.",
    "X sourit toujours aux étrangers dans la rue juste pour rendre leur journée meilleure.",
    "X rend souvent visite à ses amis d’enfance.",
    "X aime avoir de longues conversations avec ses amis.",
    "X a proposé sa place dans le bus à une vieille dame car le bus était surchargé."
  ];
  var WN = [
    "X n’a pas pris la peine d’aider un étranger à trouver son chemin.",
    "X a décidé de partir tôt de la fête car il estimait que c’était trop superficiel.",
    "X préfère aller au cinéma seul plutôt qu'avec un ami.",
    "X a crié sur le conducteur qui lui a volé la dernière place de parking libre.",
    "X parle rarement à ses colocataires.",
    "X n’a pas voulu féliciter le gagnant d’un concours.",
    "X n'est pas allé·e à l'enterrement de sa grand-mère parce qu'il/elle était trop occupé·e par son travail.",
    "X a crié à sur une petite fille car elle lui avait coupé la route au supermarché."
  ];

  staStim = {
    CP1B: "<p id='blueSta'><b>GROUPE BLEU</b></br></br>" + CP[0] + "</p>", CP1G: "<p id='greenSta'><b>GROUPE VERT</b></br></br>" + CP[0] + "</p>",
    CP2B: "<p id='blueSta'><b>GROUPE BLEU</b></br></br>" + CP[1] + "</p>", CP2G: "<p id='greenSta'><b>GROUPE VERT</b></br></br>" + CP[1] + "</p>",
    CP3B: "<p id='blueSta'><b>GROUPE BLEU</b></br></br>" + CP[2] + "</p>", CP3G: "<p id='greenSta'><b>GROUPE VERT</b></br></br>" + CP[2] + "</p>",
    CP4B: "<p id='blueSta'><b>GROUPE BLEU</b></br></br>" + CP[3] + "</p>", CP4G: "<p id='greenSta'><b>GROUPE VERT</b></br></br>" + CP[3] + "</p>",
    CP5B: "<p id='blueSta'><b>GROUPE BLEU</b></br></br>" + CP[4] + "</p>", CP5G: "<p id='greenSta'><b>GROUPE VERT</b></br></br>" + CP[4] + "</p>",
    CP6B: "<p id='blueSta'><b>GROUPE BLEU</b></br></br>" + CP[5] + "</p>", CP6G: "<p id='greenSta'><b>GROUPE VERT</b></br></br>" + CP[5] + "</p>",
    CP7B: "<p id='blueSta'><b>GROUPE BLEU</b></br></br>" + CP[6] + "</p>", CP7G: "<p id='greenSta'><b>GROUPE VERT</b></br></br>" + CP[6] + "</p>",
    CP8B: "<p id='blueSta'><b>GROUPE BLEU</b></br></br>" + CP[7] + "</p>", CP8G: "<p id='greenSta'><b>GROUPE VERT</b></br></br>" + CP[7] + "</p>",

    CN1B: "<p id='blueSta'><b>GROUPE BLEU</b></br></br>" + CN[0] + "</p>", CN1G: "<p id='greenSta'><b>GROUPE VERT</b></br></br>" + CN[0] + "</p>",
    CN2B: "<p id='blueSta'><b>GROUPE BLEU</b></br></br>" + CN[1] + "</p>", CN2G: "<p id='greenSta'><b>GROUPE VERT</b></br></br>" + CN[1] + "</p>",
    CN3B: "<p id='blueSta'><b>GROUPE BLEU</b></br></br>" + CN[2] + "</p>", CN3G: "<p id='greenSta'><b>GROUPE VERT</b></br></br>" + CN[2] + "</p>",
    CN4B: "<p id='blueSta'><b>GROUPE BLEU</b></br></br>" + CN[3] + "</p>", CN4G: "<p id='greenSta'><b>GROUPE VERT</b></br></br>" + CN[3] + "</p>",
    CN5B: "<p id='blueSta'><b>GROUPE BLEU</b></br></br>" + CN[4] + "</p>", CN5G: "<p id='greenSta'><b>GROUPE VERT</b></br></br>" + CN[4] + "</p>",
    CN6B: "<p id='blueSta'><b>GROUPE BLEU</b></br></br>" + CN[5] + "</p>", CN6G: "<p id='greenSta'><b>GROUPE VERT</b></br></br>" + CN[5] + "</p>",
    CN7B: "<p id='blueSta'><b>GROUPE BLEU</b></br></br>" + CN[6] + "</p>", CN7G: "<p id='greenSta'><b>GROUPE VERT</b></br></br>" + CN[6] + "</p>",
    CN8B: "<p id='blueSta'><b>GROUPE BLEU</b></br></br>" + CN[7] + "</p>", CN8G: "<p id='greenSta'><b>GROUPE VERT</b></br></br>" + CN[7] + "</p>",

    WP1B: "<p id='blueSta'><b>GROUPE BLEU</b></br></br>" + WP[0] + "</p>", WP1G: "<p id='greenSta'><b>GROUPE VERT</b></br></br>" + WP[0] + "</p>",
    WP2B: "<p id='blueSta'><b>GROUPE BLEU</b></br></br>" + WP[1] + "</p>", WP2G: "<p id='greenSta'><b>GROUPE VERT</b></br></br>" + WP[1] + "</p>",
    WP3B: "<p id='blueSta'><b>GROUPE BLEU</b></br></br>" + WP[2] + "</p>", WP3G: "<p id='greenSta'><b>GROUPE VERT</b></br></br>" + WP[2] + "</p>",
    WP4B: "<p id='blueSta'><b>GROUPE BLEU</b></br></br>" + WP[3] + "</p>", WP4G: "<p id='greenSta'><b>GROUPE VERT</b></br></br>" + WP[3] + "</p>",
    WP5B: "<p id='blueSta'><b>GROUPE BLEU</b></br></br>" + WP[4] + "</p>", WP5G: "<p id='greenSta'><b>GROUPE VERT</b></br></br>" + WP[4] + "</p>",
    WP6B: "<p id='blueSta'><b>GROUPE BLEU</b></br></br>" + WP[5] + "</p>", WP6G: "<p id='greenSta'><b>GROUPE VERT</b></br></br>" + WP[5] + "</p>",
    WP7B: "<p id='blueSta'><b>GROUPE BLEU</b></br></br>" + WP[6] + "</p>", WP7G: "<p id='greenSta'><b>GROUPE VERT</b></br></br>" + WP[6] + "</p>",
    WP8B: "<p id='blueSta'><b>GROUPE BLEU</b></br></br>" + WP[7] + "</p>", WP8G: "<p id='greenSta'><b>GROUPE VERT</b></br></br>" + WP[7] + "</p>",

    WN1B: "<p id='blueSta'><b>GROUPE BLEU</b></br></br>" + WN[0] + "</p>", WN1G: "<p id='greenSta'><b>GROUPE VERT</b></br></br>" + WN[0] + "</p>",
    WN2B: "<p id='blueSta'><b>GROUPE BLEU</b></br></br>" + WN[1] + "</p>", WN2G: "<p id='greenSta'><b>GROUPE VERT</b></br></br>" + WN[1] + "</p>",
    WN3B: "<p id='blueSta'><b>GROUPE BLEU</b></br></br>" + WN[2] + "</p>", WN3G: "<p id='greenSta'><b>GROUPE VERT</b></br></br>" + WN[2] + "</p>",
    WN4B: "<p id='blueSta'><b>GROUPE BLEU</b></br></br>" + WN[3] + "</p>", WN4G: "<p id='greenSta'><b>GROUPE VERT</b></br></br>" + WN[3] + "</p>",
    WN5B: "<p id='blueSta'><b>GROUPE BLEU</b></br></br>" + WN[4] + "</p>", WN5G: "<p id='greenSta'><b>GROUPE VERT</b></br></br>" + WN[4] + "</p>",
    WN6B: "<p id='blueSta'><b>GROUPE BLEU</b></br></br>" + WN[5] + "</p>", WN6G: "<p id='greenSta'><b>GROUPE VERT</b></br></br>" + WN[5] + "</p>",
    WN7B: "<p id='blueSta'><b>GROUPE BLEU</b></br></br>" + WN[6] + "</p>", WN7G: "<p id='greenSta'><b>GROUPE VERT</b></br></br>" + WN[6] + "</p>",
    WN8B: "<p id='blueSta'><b>GROUPE BLEU</b></br></br>" + WN[7] + "</p>", WN8G: "<p id='greenSta'><b>GROUPE VERT</b></br></br>" + WN[7] + "</p>",
  };

  stimStaOrd = []; // Ordered statements by group color
  staOrd.map(function (sta) { stimStaOrd.push({ stimulus: staStim[sta] }) });

  /* Fullscreen mode */
  var activeFullscreen = {
    message: function () {
      html = "";
      html += "<h1>CONSENTEMENT ÉCLAIRÉ</h1>";
      html += "<p class='justify'>Merci de votre intérêt et de votre participation à cette étude ";
      html += "administrée par Mathias Schmitz. L'expérience se déroulera en ligne et dure approximativement ";
      html += "30 minutes.</br></br>";
      html += "Vous avez le droit de vous retirer de l'expérience à tout moment, ";
      html += "sans devoir vous justifier et sans subir aucun préjudice. Nous vous rappelons également ";
      html += "que si vous vous retirez de l'étude, vous conserverez le bénéfice obtenu des crédits ";
      html += "attribués pour cette participation. Par ailleurs, nous garantissons également la ";
      html += "confidentialité et l'anonymat de vos réponses. Des informations complémentaires peuvent ";
      html += "être obtenues à tout moment auprès du chercheur responsable.</br></br>Sachez que vous pouvez contacter ";
      html += "Monsieur Jan de Mol pour rapporter ou discuter des problèmes liés à ";
      html += "votre participation à la recherche.</p>";
      return html;
    },
    button_label: "Je donne mon consentement libre et éclairé pour participer en tant que sujet à cette recherche",
    type: 'fullscreen',
    fullscreen_mode: true,
    delay_after: 200,
  };

  /* Sta rdm instructions; see Dotsch 2013 (similarities between members)*/
  var staRdmInst = {
    type: "html-keyboard-response",
    post_trial_gap: 200,
    choices: [32],
    stimulus: function () {
      var html = "";
      html += "<h1>FORMATION D'IMPRESSIONS</h1>";
      html += "<p class='justify'>L'objectif de cette tâche est de vous faire une impression ";
      html += "de deux groupes : ";
      html += "le groupe des <span id='blue'>BLEUS</span> et ";
      html += "le groupe des <span id='green'>VERTS</span>.</br></br>";
      html += "Sachez que le nom des groupes n'a pas d'importance en soi, mais que les membres ";
      html += "d'un même groupe sont similaires entre eux : ";
      html += "ils partagent des idées et croyances similaires, ont des personnalitées semblables et ";
      html += "se comportent souvent de manière similaire. Par contre, les membres des deux groupes ";
      html += "sont différents les uns des autres.</br></br>";
      html += "Afin que vous puissiez vous faire une impression des deux groupes, ";
      html += "nous vous présenterons un à un des comportement typiques (rendus anonymes) ";
      html += "réalisés par les membres des deux groupes. ";
      html += "Chaque comportement vous sera présenté avec un arrière-plan coloré (bleu ou vert), ";
      html += "indiquant ainsi le groupe d’appartenance de son auteur.</br></br>";
      html += "Votre tâche consiste à <b>lire</b> les comportements et ";
      html += "à vous <b>faire une impression</b> de ces deux groupes.</br></br>";
      html += "Les comportements défileront de manière automatique. Veuillez rester concentré·e.</p>";
      html += "<p></br>appuyez sur <span class='light-keys'><kbd>espace</kbd></span> pour commencer</p>";
      return html;
    },
  };

  /* Statements randomised */
  var staRandomised = {
    timeline_variables: stimStaOrd,
    randomize_order: true,
    timeline: [{
      type: 'html-keyboard-response',
      stimulus: jsPsych.timelineVariable('stimulus'),
      choices: jsPsych.NO_KEYS,
      trial_duration: delaySta,
      post_trial_gap: itiSta
    }]
  };

  /* Sta ord instructions */
  var staOrdInst = {
    type: "html-keyboard-response",
    post_trial_gap: 200,
    choices: [32],
    stimulus: function () {
      var html = "";
      html += "<h1>FORMATION D'IMPRESSIONS</h1>";
      html += "<p class='justify'>Nous allons à nouveau vous présenter les comportements mais cette fois-ci, ";
      html += "ceux-ci seront triés par groupe.</br></br>";
      html += "Comme précédemment, votre tâche consiste à <b>lire</b> les comportements et ";
      html += "vous <b>faire une impression</b> des deux groupes.</br></br>";
      html += "Les comportements défileront automatiquement.</p>";
      html += "<p></br>appuyez sur <span class='light-keys'><kbd>espace</kbd></span> pour commencer</p>";
      return html;
    },
  };

  /* Statements ordered */
  var staOrdered = {
    timeline_variables: stimStaOrd,
    randomize_order: false,
    timeline: [{
      type: 'html-keyboard-response',
      stimulus: jsPsych.timelineVariable('stimulus'),
      choices: jsPsych.NO_KEYS,
      trial_duration: delaySta,
      post_trial_gap: itiSta
    }]
  };

  /* Group description */
  var hghFstDscrp = _.sample([true, false]);

  var staDescription = {
    type: 'survey-text',
    preamble: 'Veuillez écrire en quelques lignes votre impression des groupes:',
    questions: function () {
      var G = "<span id='green'>VERTS</span>";
      var B = "<span id='blue'>BLEUS</span>";

      function sendMsg(groupName) {
        return 'les membres du groupe ' + groupName + ' sont :' + "</br><span id='min2lines'>(minimum: 2 lignes)</span>";
      };

      if (hghGrp == 'B') { var HGname = B; var LGname = G; } else { var HGname = G; var LGname = B; };

      if (hghFstDscrp) {
        return [{ prompt: sendMsg(HGname), rows: 5, columns: 80 }, { prompt: sendMsg(LGname), rows: 5, columns: 80 }];
      } else {
        return [{ prompt: sendMsg(LGname), rows: 5, columns: 80 }, { prompt: sendMsg(HGname), rows: 5, columns: 80 }];
      };
    },
    on_start: function () { $('body').css('cursor', 'default') },
    on_finish: function () { $('body').css('cursor', 'none') },
  };

  /* RC */
  /* Generate RC trials */
  var imgsRC = _.range(1, numOfPairs + 1); // generate numerical sequence

  imgsRC = imgsRC.map(function (e) {
    return ['img/faceOri' + e + '.png', 'img/faceInv' + e + '.png'];
  })

  imgsRC = _.flattenDeep(imgsRC);
  preloadimagesRC = imgsRC;

  // imgsRC = _.shuffle(imgsRC); // full randomization
  imgsRC = _.chunk(imgsRC, 12); // RC fast-12: 100 trials (6 ori + 6 anti = 12  faces per trial)

  var RCstimH = [];
  var RCstimL = [];
  imgsRC.map(function (e) { RCstimH.push({ trialImgs: e, target: HcolorHtml, trgGrp: "H" }) })
  imgsRC.map(function (e) { RCstimL.push({ trialImgs: e, target: LcolorHtml, trgGrp: "L" }) })
  var RCstim = _.flattenDeep([RCstimH, RCstimL]);

  /* RC instructions */
  var RCinst = {
    type: "html-keyboard-response",
    post_trial_gap: 200,
    choices: [32],
    stimulus: function () {
      var html = "";
      html += "<h1>TÂCHE DE CATÉGORISATION DES VISAGES</h1>";
      html += "<p class='justify'>Des recherches antérieures ont montré que les individus sont capables ";
      html += "de reconnaître les membres du groupe des <span id='blue'>BLEUS</span> et ";
      html += "des <span id='green'>VERTS</span> même s'ils n'ont jamais vu aucun de leurs membres auparavant. ";
      html += "En particulier, quand on leur présente une série de visages, ";
      html += "les individus parviennent souvent à distinguer ";
      html += "les membres de ces deux groupes.</br></br>";
      html += "Dans cette tâche, nous vous présenterons une série de visages qui ont ";
      html += "été brouillés afin de préserver l'anonymat des personnes et de rendre ";
      html += "la tâche de catégorisation un peu plus difficile. Votre objectif sera de <b>choisir le visage qui ressemble ";
      html += "le plus à un membre du groupe <i>CIBLE</i></b>. Le groupe <i>CIBLE</i> sera parfois ";
      html += "le groupe des <span id='blue'>BLEUS</span> et ";
      html += "parfois le groupe des <span id='green'>VERTS</span>.</br></br>";
      html += "La tâche comprend 200 essais au total. Utilisez votre souris pour faire votre choix. ";
      html += "Il n'y a pas de limite de temps mais sachez que les participants prennent en moyenne ";
      html += "<b>4 à 5 secondes</b> par essais. Notez également que les visages peuvent vous paraître ";
      html += "très similaires entre eux, mais ils sont en réalité bien différents. ";
      html += "Essayez de vous fier à votre <b>intuition</b> pour faire le meilleur choix.</br></br>";
      html += "N'hésitez pas à faire de courtes pauses pendant la tâche si nécessaire.</p>";
      html += "<p></br>appuyez sur <span class='light-keys'><kbd>espace</kbd></span> pour commencer</p>";
      return html;
    },
    on_finish: function () { },
  };

  /* RC */
  var i = 1;
  var RC = {
    timeline_variables: RCstim,
    // randomize_order: true,
    sample: {
      type: 'custom',
      fn: function () {
        // Alternate target every 20 trials
        var chunks = 20;

        // starts at 0
        var H = _.range(0, 100);
        var L = _.range(100, 200);

        H = _.shuffle(H);
        L = _.shuffle(L);

        H = _.chunk(H, chunks);
        L = _.chunk(L, chunks);

        var HL = H.map(function (e, i) { // merge two arrays so that the values alternate
          return [e, L[i]];
        });
        var LH = L.map(function (e, i) {
          return [e, H[i]];
        });

        t = _.sample([HL, LH]);
        t = _.flattenDeep(t);

        return t;
      }
    },
    data: {
      task: 'RC',
      trgGrp: jsPsych.timelineVariable('trgGrp')
    },
    timeline: [{
      type: 'html-mouse-response',
      stimulus: function () {
        var html = "";
        html += "<p>Choisissez le visage qui ressemble le plus à un membre du " + jsPsych.timelineVariable('target', true) + " :</br></br>";
        jsPsych.timelineVariable('trialImgs', true).map(function (e) {
          html += "<img class='rcimg-12' src='" + e + "'>";
        });
        html += "</br>Essais : " + i + "/200</br>";
        i += 1;
        return html;
      },
    }],
    on_start: function (trial) {
      $('body').css('cursor', 'default');
      if (_.includes(trial.stimulus, 'green')) {
        $('.jspsych-content-wrapper').css('background-color', "rgba(36, 122, 43, 0.1)");
      } else if (_.includes(trial.stimulus, 'blue')) {
        $('.jspsych-content-wrapper').css('background-color', "rgba(39, 86, 163, 0.1)");
      };
    }
  };


  /* TIMELINES ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ */
  timeline.push(activeFullscreen);
  timeline.push(staRdmInst);
  timeline.push(staRandomised);
  timeline.push(staOrdInst);
  timeline.push(staOrdered);
  timeline.push(staDescription);
  timeline.push(RCinst);
  timeline.push(RC);

  /* INITIALISE EXP  ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ */
  jsPsych.init({
    timeline: timeline,
    preload_images: preloadimagesRC,
    max_load_time: 300 * 1000,
    exclusions: {
      min_width: 800,
      min_height: 650,
    },
    on_finish: function (data) {
      $("#jspsych-content").html("<img src='https://i.gifer.com/4V0b.gif'>");

      /* Initialize Firebase */
      var config = {
        apiKey: "AIzaSyD4r9uWI4icto61fm2tC9neKdEiOUWzMJ8",
        databaseURL: "https://biatw-68fe6.firebaseio.com/"
      };

      firebase.initializeApp(config);
      var database = firebase.database();
      if (id == null) { id = jsPsych.randomization.randomID(15) }; // if no id provided, generate an id

      /* Qualtrics url parameters */
      qlink += "?id=" + id;
      qlink += "&windWidth=" + window.innerWidth || document.documentElement.clientWidth || document.body.clientWidth;
      qlink += "&windHeight=" + window.innerHeight || document.documentElement.clientHeight || document.body.clientHeight;
      qlink += "&screenWidth=" + screen.width || 0;
      qlink += "&screenHeight=" + screen.height || 0;
      qlink += "&userAgent=" + navigator.userAgent;
      qlink += "&totalTime=" + jsPsych.totalTime();

      /* jsPsych: add data to every trial */
      jsPsych.data.addProperties({
        id: id,
        hghGrp: hghGrp,           // H-group color: "G" | "B"
        inGrp: inGrp,             // Ingroup color: "G" | "B"
        status: status,           // Participant status: "H" | "L" | "O" (always "O")
        hghFstSta: hghFstSta,     // 
        hghFstDscrp: hghFstDscrp
      });

      var dataRC = data.filter({ task: 'RC' }).csv();
      //jsPsych.data.displayData();

      /* Send data to Firebase and redirect to Qualtrics */
      database.ref("RCClab/" + id + "/").update({ dataRC }).then(function () {
        console.log("Data sent!");
        window.location = qlink; // redirect to qualtrics
      });
    }
  });
</script>

</html>