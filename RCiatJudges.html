<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8">
  <title>exp</title>
  <script src="jspsych-6.0.3/jspsych.js"></script>
  <script src="jspsych-6.0.3/plugins/jspsych-fullscreen.js"></script>
  <script src="jspsych-6.0.3/plugins/jspsych-html-keyboard-response.js"></script>
  <script src="jspsych-6.0.3/plugins/jspsych-html-button-response.js"></script>
  <script src="jspsych-6.0.3/plugins/jspsych-survey-text.js"></script>
  <script src="jspsych-6.0.3/plugins/jspsych-survey-likert.js"></script>
  <script src="jspsych-6.0.3/plugins/jspsych-survey-multi-choice.js"></script>
  <script src="js/jspsych-html-slider-response_required.js"></script>
  <script src="js/jquery.min.js"></script>
  <script src="js/lodash.min.js"></script>
  <script src="js/firebase.js"></script>
  <link href="jspsych-6.0.3/css/jspsych.css" rel="stylesheet" type="text/css">
  <style>
    body {
      cursor: default;
    }

    #jspsych-html-slider-response-next {
      margin: 0px;
    }

    .imgJudge {
      width: 300px;
      margin: 0px;
      padding: 0px;
    }

    .jspsych-content-wrapper {
      width: 800px;
      height: 600px;
    }
  </style>
</head>

<body></body>
<script>

  // Parameters
  var n = 10; // number of CIs randomly sampled for each cell (default: 10)
  var rt_ci_preview = 1000; // time that each CI is exposed (default: 1000)
  var rt_inter_ci_preview = 200; // inter-CI time (default: 200)
  var githubCIs = 'https://matschmitz.github.io/noisyFaces/iat_cis/'; // github CIs path

  // Initial variables
  var timeline = [];
  var preloadimages = [];
  var prolificID = jsPsych.data.getURLVariable("prolificID"); // Need to add ?prolificID={{%PROLIFIC_PID%}} at the end of the prolific survey link!
  var id = jsPsych.data.getURLVariable("id");
  if (id == null) { id = jsPsych.randomization.randomID(15) };

  // PREVIEW IND CIS STIMS
  var preview_CIsIndStims = [
    "ind_RC02_5min_adsbb84c95xyf8g.png",
    "ind_RC02_5min_dnq5jlm7tdokjvb.png",
    "ind_RC02_5min_k46bq6je2vtu3c8.png",
    "ind_RC02_5min_wpr27spour7marm.png",
    "ind_RC02_5min_7a77y2yy1ku1v0g.png",
    "ind_RC02_10min_ukmeh35gmwsxahg.png",
    "ind_RC02_10min_wukmbco4sjjla5w.png",
    "ind_RC02_10min_n8tv09h3xdgsy23.png",
    "ind_RC02_10min_kpt53jne7f54730.png",
    "ind_RC02_10min_1ushcky6gd9pwjd.png",
    "ind_RC12_5min_53wnl7pm7lmvndn.png",
    "ind_RC12_5min_4pw17fwr9goww0s.png",
    "ind_RC12_5min_myxa2xypxxgv80v.png",
    "ind_RC12_5min_b842oyv5gwot3lk.png",
    "ind_RC12_5min_p3hhgnc87mt2cwb.png",
    "ind_RC12_10min_g38apayaewke27z.png",
    "ind_RC12_10min_ymkrz3p4r0o6czr.png",
    "ind_RC12_10min_xbq9uouj4u6f9w2.png",
    "ind_RC12_10min_b2obtl2df19yryw.png",
    "ind_RC12_10min_oeo4vqhsxyb8q54.png",
  ];

  preview_CIsIndStims = preview_CIsIndStims.map(function (e) { return githubCIs + e });
  preloadimages.push(preview_CIsIndStims);
  preview_CIsIndStims = preview_CIsIndStims.map(function (e) { return { imgHtml: "<img class='imgJudge' src='" + e + "'>" } });

  // IND CIS STIMS
  var id_RC02 = [
    '087ktwznm1hln06',
    '0pyj2qysh5flkco',
    '141qvhezebcchpl',
    '1m58mo1shho4kom',
    '1otwl1rmw7az7wv',
    '1ushcky6gd9pwjd',
    '20uj04zqznvmg08',
    '28ve91mcog7dw39',
    '35zaas5gkbcd62s',
    '3daeqxgmf3fe5yl',
    '3fpb6rskd072r63',
    '3wxd9ucdkhet29u',
    '47ehl2bqt73h56z',
    '48p7p5fguo5we2t',
    '5do7qsc4om0szql',
    '5e3jrg2j127ojz2',
    '5spmbuv3g0hjnm3',
    '630vsc9anojz8ag',
    '6o5gjppw80lh3ws',
    '6ojjqj9s48nredc',
    '7a77y2yy1ku1v0g',
    '7b431oqb68338f9',
    '83xln9x9pyzbxsr',
    '8r4dges1k0qfqa7',
    '9t7syl0mbwu04wn',
    'a22h3kvq92n91gd',
    'a9902xovoolss8n',
    'adsbb84c95xyf8g',
    'aovgyms4bljht6j',
    'ay5jfh4l73pkbqd',
    'bp7avjmvply83kr',
    'c0nqq4u3jama7dn',
    'cb1rmdgewth48d7',
    'cpfdnqt0cezf4nv',
    'cs1ek7ell441bnk',
    'd80cckzwsg8annp',
    'dbdm1e7exdhu8t6',
    'dfrkcey5346epwv',
    'dnq5jlm7tdokjvb',
    'e08tr18e4a2qkm7',
    'eumuw5cl6ex6whb',
    'f4j69nswm84qelt',
    'f5kg1eul6807w9h',
    'frgy7avn1z7km7p',
    'ft1squ4yt98scoq',
    'ftcmac4412tm2km',
    'gevebx3o86x0arq',
    'gl7565cxyc4k8j1',
    'ha1g0sdw9krfoqc',
    'hdgjl4bqf5x42se',
    'hu1934c8bvtlu5f',
    'j0011y93rgg0vkz',
    'j7eht76uwfja5fp',
    'jehmdqzz7852zs6',
    'jhq59jkfz82fpc6',
    'jl4rpe7b95l1o85',
    'jufjp6yd1a9hlm1',
    'jygmz0517kamd22',
    'k46bq6je2vtu3c8',
    'kmohthu9qvnwda3',
    'kpt53jne7f54730',
    'lo1gygpn12bz3w9',
    'mgd6ffso49c9gvq',
    'n699xvmdkwcy8uw',
    'n8tv09h3xdgsy23',
    'nfd9luxo7xec627',
    'ngjublbwq4ytaz4',
    'o9jcvdw1w5oenvy',
    'ofzkmu0yod4hpnn',
    'oqatkxqsougtvxw',
    'ow8kultq38w1goy',
    'ozwo3cylp4r9qd8',
    'p6b5zc7v10d517z',
    'p7kyek2319yea7k',
    'pt3lwf8hxup7gm5',
    'q3rll72v3vavfxo',
    'qesa0w4rx0m07qj',
    'qq5jwqlk40layls',
    'r283l6t5jzgttrt',
    'reswmnxr93bjzv3',
    'son0w4eu5dm9sau',
    'sud4tt8eb3y1mr4',
    't9r6soaved4mzr8',
    'tdram2ggxl6wpo7',
    'tfedpdckrzu5vtg',
    'tfzawlyzmyq79l2',
    'tuejcp3fora9onq',
    'u3j6grdp36p085r',
    'ukmeh35gmwsxahg',
    'vgtq0rbandz7seo',
    'wnc0g7hsn395dms',
    'wpr27spour7marm',
    'wukmbco4sjjla5w',
    'wyzdj4ksq1ltj64',
    'x1ss8jyo1vsj6b0',
    'x2vr7z090zqbf5y',
    'x3zr2owc5u82sn5',
    'xr5gy1gg71bcc2m',
    'y2xb6uf6940entf',
    'y5en3ouv2klc5l4',
    'ymhzj2r0s6akxtp',
    'ytx2r9ryr06u772',
    'z4mwc3vlva2p73o',
    'zrhzpufbda5sesf',
  ];

  var id_RC12 = [
    '015f58jhfkyzt9n',
    '06y64xh8c8v5d6g',
    '1cw01o1d37n0ejo',
    '1pbe110yjx9wwjk',
    '1qtzosc0etcuvx7',
    '20pgdq5w9yy1lkn',
    '2l4zfos0pkqhaxt',
    '2vcmmsgy5w5bg82',
    '2wukrpbxeck2cl4',
    '30nwz78t3ayhsx4',
    '353y7wnlhxhvz03',
    '3lz5ukzkvume5pp',
    '3sqj199ssz9pcl2',
    '3wp176chwyha7yy',
    '45atufyjd4mx28a',
    '48m4bwym2hjzjl9',
    '48ub3xz6gtl1rns',
    '499672hna0xoc8u',
    '4pw17fwr9goww0s',
    '4pysj3s87gcmlmc',
    '4rv4qj6axz2m9zj',
    '53wnl7pm7lmvndn',
    '5njgu7e62j748ax',
    '66y780n5amt04l9',
    '6t1obp27g66w6zo',
    '754jjwmse2zcewc',
    '7xdpje7xh38dnqu',
    '807c20bgk6edltl',
    '85opjgbbg5uxtpb',
    '8e90bjhxh1wkjmp',
    '8ncyqgjo7ep9j96',
    '8z1k8ww1rnk1dek',
    '93fd2k6dsnyswc3',
    '94mpx0d1nm0n7v8',
    '9j4nxfcgw236eyl',
    '9kthug5koyua5ys',
    'a9cxbz53ahpzet1',
    'b2obtl2df19yryw',
    'b5egmhnzvytrqe5',
    'b842oyv5gwot3lk',
    'bdwmtr1zhchu9dm',
    'bpdq3m80tl7nokd',
    'bvnh7vxt52otgct',
    'cm5vlvo05fjo7pp',
    'd98ot47h042zl55',
    'dmmydrbcrohwpl9',
    'erbwxru0afoeop6',
    'ewa2uot1us46jnt',
    'f1zgzgmxus0tal5',
    'fd0o1ej7u0n1tn6',
    'g38apayaewke27z',
    'gwtcsg5yth32wmn',
    'hck3a2h7dso2wf3',
    'hkhzc181n2nkukm',
    'hkmm6gsqw160nbl',
    'huy2su0ae2z734l',
    'hvqzknyv6kmd2cn',
    'k10tx23joj60kpd',
    'kg67an706sx0z4d',
    'kxc42rv01osy4du',
    'kys2ylrdh3f617e',
    'lc4bb3bpdsyylak',
    'lf5rzt8v9w7xzjt',
    'll9zbbxr10c3qmr',
    'ls5skw3xmq1fg48',
    'ltumf5l7p5olcrg',
    'lvs0rcpo3jkhm98',
    'lxag9s3ffxk7dhs',
    'm3xk7n9waxq9jrt',
    'm81525asphqqe56',
    'mnwcunmzvk4at0v',
    'myxa2xypxxgv80v',
    'nlnjen6z8fa3mbw',
    'nuru3svdjgp9fn3',
    'ob6l1h9c1wy46pl',
    'oeo4vqhsxyb8q54',
    'op0tt7fo5njugyf',
    'orm9uxhfyz2w5ed',
    'p3hhgnc87mt2cwb',
    'p5m5pd1jtxu9jly',
    'pa6dljz8fqkm5gs',
    'ppe63slub4kwrd4',
    'qymmdkr4wrjydvr',
    'rek3rfc0om3uor3',
    'ryff45y35rpczo6',
    'sqdqxehw9vp49wc',
    't4zow9p40s6qchp',
    't5tqhrmfhq01z2s',
    'u9qkp7k5uaj8oju',
    'ujh473zhq6hn84z',
    'uoqh53oxxg0s2gt',
    'uvpxzdf2z60eol5',
    'uw5m7vsqz8vdfh3',
    'uzwdp450bfz9nw4',
    'v3jqwwb0ts8twz4',
    'v8umcrehr1481po',
    'vmva06do1qwkp7j',
    'w3po6zr88f2yhct',
    'xbq9uouj4u6f9w2',
    'xg7hpebupm0opv4',
    'xnn0ulp2v2wyyo1',
    'xr1egztrzxle35d',
    'xs587mhpgb1xpam',
    'ymkrz3p4r0o6czr',
    'z35cp5zfyn4c5v0',
    'zlsdvrg89wehuwx',
  ];

  var cis_ind_sampled_RC02_5min = _.sampleSize(id_RC02, n);
  var cis_ind_sampled_RC02_10min = cis_ind_sampled_RC02_5min;
  var cis_ind_sampled_RC12_5min = _.sampleSize(id_RC12, n);
  var cis_ind_sampled_RC12_10min = cis_ind_sampled_RC12_5min;

  var CIsIndStims = [  // add URL path
    cis_ind_sampled_RC02_5min.map(function (e) { return githubCIs + 'ind_RC02_5min_' + e + '.png' }),
    cis_ind_sampled_RC02_10min.map(function (e) { return githubCIs + 'ind_RC02_10min_' + e + '.png' }),
    cis_ind_sampled_RC12_5min.map(function (e) { return githubCIs + 'ind_RC12_5min_' + e + '.png' }),
    cis_ind_sampled_RC12_10min.map(function (e) { return githubCIs + 'ind_RC12_10min_' + e + '.png' }),
  ];
  CIsIndStims = _.flattenDeep(CIsIndStims);
  preloadimages.push(CIsIndStims);

  CIsIndStims = CIsIndStims.map(function (e) { return { imgHtml: "<img class='imgJudge' src='" + e + "'>" } }); // add img html format
  CIsIndStims = _.flattenDeep(CIsIndStims);
  CIsIndStims = _.shuffle(CIsIndStims);

  // AVG CIS STIMS
  var cis_avg = [
    "avg_RC02_5min_iatlow.png",
    "avg_RC02_10min_iatlow.png",
    "avg_RC02_5min_iatmoderate.png",
    "avg_RC02_10min_iatmoderate.png",
    "avg_RC02_5min_iathigh.png",
    "avg_RC02_10min_iathigh.png",
    "avg_RC12_5min_iatlow.png",
    "avg_RC12_10min_iatlow.png",
    "avg_RC12_5min_iatmoderate.png",
    "avg_RC12_10min_iatmoderate.png",
    "avg_RC12_5min_iathigh.png",
    "avg_RC12_10min_iathigh.png"
  ];
  CIsAvgStims = cis_avg.map(function (e) { return githubCIs + e }); // add URL path
  preloadimages.push(CIsAvgStims);

  CIsAvgStims = CIsAvgStims.map(function (e) { return { imgHtml: "<img class='imgJudge' src='" + e + "'>" } });
  CIsAvgStims = _.shuffle(CIsAvgStims); // randomize order

  // EXPERIMENT --------------------------------------------------------------------------------------------------------
  /* FULL SCREEN & CONSENT */
  var fullScreenConsent = {
    button_label: "J'accepte de participer à cette étude",
    type: 'fullscreen',
    fullscreen_mode: true,
    delay_after: 200,
    message: function () {
      html = "";
      html += "<h1>Consentement éclairé</h1>";
      html += "<p class='justify'>Merci de votre intérêt et de votre participation à cette étude sur l'évaluation des visages. ";
      html += "Dans cette étude, il vous sera demandé d'évaluer plusieurs visages. ";
      html += "Il est important que vous restiez pleinement <b>concentré·e.</b></br></br>";
      html += "Votre participation est volontaire, n'entraîne aucun risque, vos réponses seront anonymisées, ";
      html += "et vous êtes libre de vous retirer de l'étude à tout moment. ";
      html += "Après avoir complété l'entièreté de l'étude, vous recevrez une <strong>compensation monétaire</strong> ";
      html += "tel que décrit dans l'annonce Foule Factory.</br></br>";
      html += "Cette étude est administrée par Mathias Schmitz et Marine Rougier de l'UCLouvain (Belgique). ";
      html += "Si vous avez des questions ou des commentaires, ";
      html += "n'hésitez pas à nous contacter à :</br>mathias.schmitz@uclouvain.be</p>";
      return html;
    },
  };

  /* PREVIEW IND CIS INSTRUCTIONS */
  var previewIndCisInst = {
    type: "html-button-response",
    post_trial_gap: 300,
    choices: ['commencer'],
    stimulus: function () {
      var html = "";
      html += "<h1>Evaluation des visages</h1>";
      html += "<p class='justify'>Dans cette étude, vous allez devoir <b>évaluer des visages</b> (52 visages en tout) et indiquer, "
      html += "pour chacun d'entre eux, à quel point celui-ci vous paraît <b>aggressif</b> et <b>digne de confiance</b>. ";
      html += "Comme vous allez le voir, les visages qui vous seront présentés ont été rendus ";
      html += "<b>flous</b> afin de rendre la tâche moins aisée.</br></br>";
      html += "Avant la tâche d’évaluation, un échantillon de 20 visages ";
      html += "va vous être présenté (chaque visage apparaitra durant une seconde). Ceci vous permettra de mieux ";
      html += "prendre en compte les similarités/différences entre les visages avant leur évaluation.</br></br>";
      html += "Les visages défileront automatiquement, veuillez être attentif.</p>";
      return html;
    },
  };

  /* PREVIEW IND CIS */
  var previewIndCI = {
    timeline_variables: preview_CIsIndStims,
    choices: jsPsych.NO_KEYS,
    randomize_order: true,
    trial_duration: rt_ci_preview,
    post_trial_gap: rt_inter_ci_preview,
    timeline: [{
      type: 'html-keyboard-response',
      stimulus: function () { return jsPsych.timelineVariable('imgHtml', true) },
    }]
  };

  /* JUDGE IND CIS INSTRUCTIONS*/
  var judgeIndInst = {
    type: "html-button-response",
    post_trial_gap: 300,
    choices: ['commencer'],
    stimulus: function () {
      var html = "";
      html += "<h1>Evaluation des visages</h1>";
      html += "<p class='justify'>Maintenant que des exemples de visages vous ont été présentés, ";
      html += "vous allez devoir évaluer un premier échantillon de <b>40 visages</b>.</br></br>";
      html += "Pour rappel, vous devrez indiquer pour chaque visage à quel point celui-ci vous paraît ";
      html += "<b>criminel</b> et <b>digne de confiance</b> (de -3 = pas du tout à +3 = totalement).</br></br>";
      html += "Notez qu'il est extrêmement important que vous répondiez aussi <b>honnêtement et ";
      html += "spontanément</b> que possible. La première réponse qui vient à l'esprit est généralement la meilleure.</br></br>";
      html += "Une fois que vous aurez fini d'évaluer ce premier échantillon de visages, ";
      html += "vous devrez ensuite évaluer un deuxième échantillon composé de 12 visages.</p>";
      return html;
    },
  };

  /* JUDGE IND CIS*/
  var scaleCriminality = ["-3</br>Pas du tout criminel", "-2", "-1", "0", "+1", "+2", "+3</br>Totalement criminel"];
  var scaleTrustworthiness = ["-3</br>Pas du tout digne de confiance", "-2", "-1", "0", "+1", "+2", "+3</br>Totalement digne de confiance"];

  var judgeIndCIs = [];

  CIsIndStims.map(function (ciImg) {
    var likert_trial = {
      type: 'survey-likert',
      preamble: ciImg.imgHtml,
      questions: [
        { prompt: "", labels: scaleCriminality, required: true },
        { prompt: "", labels: scaleTrustworthiness, required: true },
      ],
      button_label: 'Continuer',
      on_load: function () {
        $(".jspsych-content").css("max-width", "100%");
        $(".jspsych-survey-likert-statement").css("margin", "25px 0 0");
        $(".jspsych-survey-likert-statement").css("padding", "0px");
        $(".jspsych-survey-likert-opts").css("padding", "0 0 10px");
        $("#jspsych-survey-likert-next").css("margin-top", "10px");
        $("#jspsych-survey-likert-form").css("width", "800px");
        $("li").css("width", "12%");
        //   $("li:first-of-type").css("width", "110px");
        //   $("li:last-of-type").css("width", "110px");
      },
      on_finish: function (data) {
        data.ci = ciImg.imgHtml;
        var parsed_response = JSON.parse(data.responses);
        data.criminality = parsed_response.Q0 - 3;
        data.trustworthiness = parsed_response.Q1 - 3;
        console.log(data.ci);
        console.log(data.criminality);
        console.log(data.trustworthiness);
      },
    };
    judgeIndCIs.push(likert_trial);
  });

  /* PREVIEW AVG CIS INSTRUCTIONS */
  var previewAvgCisInst = {
    type: "html-button-response",
    post_trial_gap: 300,
    choices: ['commencer'],
    stimulus: function () {
      var html = "";
      html += "<h1>Evaluation des visages</h1>";
      html += "<p class='justify'>Vous allez maintenant devoir évaluer un deuxième échantillon de <b>12 visages</b> et ";
      html += "indiquer pour chaque visage à quel point celui-ci vous paraît ";
      html += "<b>criminel</b> et <b>digne de confiance</b>.</br></br>";
      html += "Avant la tâche d’évaluation, les 12 visages ";
      html += "vous seront présentés (chaque visage apparaitra durant une seconde). Ceci vous permettra de mieux ";
      html += "prendre en compte les similarités/différences entre les visages avant leur évaluation.</br></br>";
      html += "Les visages défileront automatiquement, veuillez être attentif.</p>";
      return html;
    },
    on_load: function () {
      $(".jspsych-content").css("max-width", "90%");
    }
  };

  /* PREVIEW AVG CIS */
  var previewAvgCI = {
    timeline_variables: CIsAvgStims,
    choices: jsPsych.NO_KEYS,
    randomize_order: true,
    trial_duration: rt_ci_preview,
    post_trial_gap: rt_inter_ci_preview,
    timeline: [{
      type: 'html-keyboard-response',
      stimulus: function () { return jsPsych.timelineVariable('imgHtml', true) },
    }]
  };

  /* JUDGE AVG CIS INSTRUCTIONS*/
  var judgeAvgInst = {
    type: "html-button-response",
    post_trial_gap: 300,
    choices: ['commencer'],
    stimulus: function () {
      var html = "";
      html += "<h1>Evaluation des visages</h1>";
      html += "<p class='justify'>Vous allez maintenant devoir évaluer le deuxième échantillon de ";
      html += "<b>12 visages</b> qui vous a été présenté.</br></br>";
      html += "Les consignes ne changent pas : vous devrez indiquer pour chaque visage à quel point celui-ci vous paraît ";
      html += "<b>criminel</b> et <b>digne de confiance</b> (de -3 = pas du tout à +3 = totalement).</br></br>";
      html += "Comme précédemment, essayez de répondre aussi <b>honnêtement et spontanément</b> que possible.</p>";
      return html;
    },
  };

  /* JUDGE AVG CIS*/
  var judgeAvgCIs = [];

  CIsAvgStims.map(function (ciImg) {
    var likert_trial = {
      type: 'survey-likert',
      preamble: ciImg.imgHtml,
      questions: [
        { prompt: "", labels: scaleCriminality, required: true },
        { prompt: "", labels: scaleTrustworthiness, required: true },
      ],
      button_label: 'Continuer',
      on_load: function () {
        $(".jspsych-content").css("max-width", "100%");
        $(".jspsych-survey-likert-statement").css("margin", "25px 0 0");
        $(".jspsych-survey-likert-statement").css("padding", "0px");
        $(".jspsych-survey-likert-opts").css("padding", "0 0 10px");
        $("#jspsych-survey-likert-next").css("margin-top", "10px");
        $("#jspsych-survey-likert-form").css("width", "800px");
        $("li").css("width", "12%");
        //   $("li:first-of-type").css("width", "110px");
        //   $("li:last-of-type").css("width", "110px");
      },
      on_finish: function (data) {
        data.ci = ciImg.imgHtml;
        var parsed_response = JSON.parse(data.responses);
        data.criminality = parsed_response.Q0 - 3;
        data.trustworthiness = parsed_response.Q1 - 3;
        console.log(data.ci);
        console.log(data.criminality);
        console.log(data.trustworthiness);
      },
    };
    judgeAvgCIs.push(likert_trial);
  });


  /* DEMO */
  var age = {
    timeline: [{
      type: 'survey-text',
      questions: [{ prompt: "Veuillez indiquer votre âge :", rows: 1, columns: 10 }],
      button_label: "continuer",
    }],
    loop_function: function (data) {
      var age = data.values()[0].responses;
      var age = JSON.parse(age).Q0;
      if (age == "") {
        alert("Veuillez indiquer votre âge !");
        return true;
      }
    },
    on_load: function () {
      $(".jspsych-content").css("max-width", "90%");
    },
    on_finish: function (data) {
      jsPsych.data.addProperties({
        age: JSON.parse(data.responses)["Q0"],
      });
    },
  };

  var genderOptions = ['Homme', 'Femme', 'Autre'];
  var gender = {
    type: 'survey-multi-choice',
    questions: [{ prompt: "Veuillez indiquer votre genre :", options: genderOptions, required: true }],
    button_label: "continuer",
    on_finish: function (data) {
      jsPsych.data.addProperties({
        gender: JSON.parse(data.responses)["Q0"],
      });
    },
  };

  var sesOptions = ['Très bas', 'Bas', 'Moyen', 'Elevé', 'Très élevé'];
  var ses = {
    type: 'survey-multi-choice',
    questions: [{ prompt: "Quel est votre statut socio-économique ?", options: sesOptions, required: true }],
    button_label: "continuer",
    on_finish: function (data) {
      jsPsych.data.addProperties({
        ses: JSON.parse(data.responses)["Q0"],
      });
    },
  };

  var eduOptions = [
    "N'a pas terminé le Lycée",
    'Niveau Bac',
    'Formation universitaire incomplète',
    'Licence (Bac +3)',
    'Master (Bac +5)',
    "Etudes avancées (par exemple: un doctorat)"
  ];
  var edu = {
    type: 'survey-multi-choice',
    questions: [{ prompt: "Quel est votre niveau éducatif le plus élevé ?", options: eduOptions, required: true }],
    button_label: "continuer",
    on_finish: function (data) {
      jsPsych.data.addProperties({
        edu: JSON.parse(data.responses)["Q0"],
      });
    },
  };

  var frOptions = [
    "Langue maternelle",
    'Très bon',
    'bon',
    'Moyen',
    'Mauvais',
    "Très mauvais"
  ];
  var fr = {
    type: 'survey-multi-choice',
    questions: [{ prompt: "Quel est votre niveau de français ?", options: frOptions, required: true }],
    button_label: "continuer",
    on_finish: function (data) {
      jsPsych.data.addProperties({
        fr: JSON.parse(data.responses)["Q0"],
      });
    },
  };

  var originOptions = [
    "D’origine française",
    'D’origine maghrébine',
    'D’une autre origine',
  ];
  var origin = {
    type: 'survey-multi-choice',
    questions: [{ prompt: "De quelle origine vous estimez-vous ?", options: originOptions, required: true }],
    button_label: "continuer",
    on_finish: function (data) {
      jsPsych.data.addProperties({
        origin: JSON.parse(data.responses)["Q0"],
      });
    },
  };

  /* EXIT FULLSCREEN MODE */
  var exitFullscreen = {
    type: 'fullscreen',
    fullscreen_mode: false
  };

  /* DEBRIEF */
  var debrief = "";
  debrief += "<h1>Fin de l'expérience</h1>";
  debrief += "<p class='justify'>";
  debrief += "Merci pour votre participation! Cette étude avait pour but d'étudier la perception générale ";
  debrief += "qu'ont les individus de visages inconnus et ambigus.</br></br> "
  debrief += "Veuillez copier le code suivant sur Foule Factory pour valider votre participation :</p>";
  debrief += '<span style="color:#cc3300; font-weight: bold">PAZ1P9L4</span>';

  preloadimages = _.flattenDeep(preloadimages);


  // TIMELINE ----------------------------------------------------------------------------------------------------------
  timeline.push(fullScreenConsent);
  timeline.push(previewIndCisInst);
  timeline.push(previewIndCI);
  timeline.push(judgeIndInst);
  timeline.push(judgeIndCIs);
  timeline.push(previewAvgCisInst);
  timeline.push(previewAvgCI);
  timeline.push(judgeAvgInst);
  timeline.push(judgeAvgCIs);
  timeline.push(age);
  timeline.push(gender);
  timeline.push(ses);
  timeline.push(edu);
  timeline.push(fr);
  timeline.push(origin);
  timeline.push(exitFullscreen);

  timeline = _.flattenDeep(timeline); // do not remove this!


  // INITIALISE EXP ----------------------------------------------------------------------------------------------------
  jsPsych.init({
    timeline: timeline,
    preload_images: preloadimages,
    max_load_time: 500 * 1000,
    exclusions: {
      min_width: 800,
      min_height: 600,
    },
    on_finish: function (data) {
      $("#jspsych-content").html("<img src='https://i.gifer.com/4V0b.gif'>");

      /* Initialize Firebase */
      var config = {
        apiKey: "AIzaSyD4r9uWI4icto61fm2tC9neKdEiOUWzMJ8",
        databaseURL: "https://biatw-68fe6.firebaseio.com/"
      };

      firebase.initializeApp(config);
      var database = firebase.database();

      /* jsPsych: add data to every trial */
      jsPsych.data.addProperties({
        prolificID: prolificID,
        id: id,
        totalTime: jsPsych.totalTime()
      });

      var subdata = data.filter({ trial_type: 'survey-likert' }).csv();

      /* Send data to Firebase and redirect to Qualtrics */
      database.ref("RCiatJudges/" + id + "/").update({ subdata }).then(function () {
        console.log("data sent!");
        $("#jspsych-content").html(debrief);
      });
    }
  });

</script>

</html>